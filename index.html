<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>I love the air</title>

</head>

<body>
<p id="averages"> </p>
<form id="timeScaleForm">
	I want data from since <input type="text" name="timeVal"> hours ago
	<input type="button" onclick="updateTimeScale()">
</form>
	<script>
		function updateTimeScale(){
			socket.emit("newTimescale", document.forms["timeScaleForm"]["timeVal"].value * 3600000);
			charts.forEach(elem => {
			while(elem.series.length > 0)
			    elem.series[0].remove(true);
			});
		}
	</script>
<div id="tempChart_container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
<div id="humidityChart_container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
	<script src='/socket.io/socket.io.js'>
	</script>
	<script>
		var socket = io();
	</script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<script>
	var tempChart = new Highcharts.Chart({
		title: { text: 'Realtime Air Temp' },
		xAxis: {
			type: 'datetime',
			tickPixelInterval: 10
		},
		yAxis: {
			title: { text: 'temp (c)' },
			tickInterval: 5,
			min: 20,
			max: 80
		},
		chart: {
			type: 'spline',
			renderTo: 'tempChart_container',
			events: {
			}
		},
	});
	var humidityChart = new Highcharts.Chart({
		title: { text: 'Realtime Air Humidity' },
		xAxis: {
			type: 'datetime',
			tickPixelInterval: 10
		},
		yAxis: {
			title: { text: 'Humidity (%)' },
			tickInterval: 10,
			min: 0,
			max: 100
		},
		chart: {
			type: 'spline',
			renderTo: 'humidityChart_container',
			events: {
			}
		}
	});
	var charts = [tempChart, humidityChart];
$(function() {

socket.on('chartInit', function (sample) { // initalize with historical data
	tempChart.addSeries({data:(sample.data.map(function(value,index) { return  [value[0], value[1]]})), name:sample.name, id:sample.id});
	humidityChart.addSeries({data:(sample.data.map(function(value,index) { return  [value[0], value[2]]})), name:sample.name, id:sample.id});
});
socket.on('chartUpdate', function (sample){
	tempChart.get(sample.id).addPoint(sample.data[0], sample.data[1]);
	humidityChart.get(sample.id).addPoint(sample.data[0], sample.data[2]);
});
socket.on("averagesInit", function (sample){
	document.getElementById("averages").innerHTML = `<b>Average Temperature:</b>${sample.data[0]}Â°C <b>Average Humidity:</b>${sample.data[1]}% <b>Average Pressure:</b> ${sample.data[2]}hPa`
});
});
</script>
</body>
</html>
</body>
</html>
</script>
</body>
</html>
