<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>I love the air</title>

</head>

<body>
<p id="averages"> </p>
<form id="timeScaleForm">
	I want data from <input type="text" name="timeValFrom" value=0>
	<select id="unitFrom">
	<option  value=60000> Minute(s) </option>
	<option value=3600000> Hour(s) </option>
	<option value=86400000> Day(s) </option>
	<option value=31556952000> Year(s) </option>
	ago
	</select>
	to <input type="text" name="timeValTo" value=0>
	<select id="unitTo">
	<option value=60000> Minute(s) </option>
	<option value=3600000> Hour(s) </option>
	<option value=86400000> Day(s) </option>
	<option value=31556952000> Year(s) </option>
	ago
	</select>
	<input type="button" onclick="updateTimeScale()" value="go!">
</form>

	<script>
		function updateTimeScale(){
			console.log("unit from " + document.getElementById("unitFrom").value);
			console.log("value from " + document.forms["timeScaleForm"]["timeValFrom"].value)
			console.log("unit to " + document.getElementById("unitTo").value);
			console.log("value from " + document.forms["timeScaleForm"]["timeValTo"].value)
			socket.emit("newTimescale", {from:document.forms["timeScaleForm"]["timeValFrom"].value * document.getElementById("unitFrom").value, to:document.forms["timeScaleForm"]["timeValTo"].value * document.getElementById("unitTo").value});
			charts.forEach(elem => {
			while(elem.series.length > 0)
			    elem.series[0].remove(true);
			});
		}
	</script>
<div id="tempChart_container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
<div id="humidityChart_container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
	<script src='/socket.io/socket.io.js'>
	</script>
	<script>
		var socket = io();
	</script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>

<script>
  Highcharts.setOptions({
		global: {
			useUTC: false
		}
	});
var tempChart = new Highcharts.Chart({
	title: { text: 'Air Temp' },
        tooltip: {
            valueSuffix: '°C'
        },
	xAxis: {
		type: 'datetime',
		tickPixelInterval: 10
	},
	yAxis: {
		title: { text: 'temp (c)' },
		tickInterval: 5,
	},
	rangeSelector: {
		enabled: true,
		allButtonsEnabled: true
        },
	chart: {
		type: 'spline',
		zoomType: "x",
		renderTo: 'tempChart_container',
		events: {
		}
	},
});
var humidityChart = new Highcharts.Chart({
	title: { text: 'Air Humidity' },
        tooltip: {
            valueSuffix: '%'
        },
	xAxis: {
		type: 'datetime',
		tickPixelInterval: 10
	},
	yAxis: {
		title: { text: 'Humidity (%)' },
		tickInterval: 10,
	},
	rangeSelector: {
		enabled: true,
		allButtonsEnabled: true
        },
	chart: {
		type: 'spline',
		zoomType: "x",
		renderTo: 'humidityChart_container',
		events: {
		}
	}
});
var charts = [tempChart, humidityChart];
$(function() {
	socket.on('chartInit', function (sample) { // initalize with historical data
		tempChart.addSeries({data:(sample.data.map(function(value,index) { return  [value[0], value[1]]})), name:sample.name, id:sample.id});
		humidityChart.addSeries({data:(sample.data.map(function(value,index) { return  [value[0], value[2]]})), name:sample.name, id:sample.id});
	});
	socket.on('chartUpdate', function (sample){
		if( document.getElementById("unitTo").value != 0) {
			console.log(sample.data)
			tempChart.get(sample.id).addPoint(sample.data[0], sample.data[1]);
			humidityChart.get(sample.id).addPoint(sample.data[0], sample.data[2]);
		}
	});
	socket.on("averagesInit", function (sample){
		document.getElementById("averages").innerHTML = `<b>Average Temperature:</b>${sample.data[0]}°C <b>Average Humidity:</b>${sample.data[1]}% <b>Average Pressure:</b> ${sample.data[2]}hPa`
	});
});
</script>
</body>
</html>
</body>
</html>
</script>
</body>
</html>
