<!doctype html>

<html lang="en">
<head>
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.jquery.com/jquery-latest.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src='/socket.io/socket.io.js'></script>
<script>
var socket = io();

Highcharts.setOptions({
		global: {
			useUTC: false
		}
});
</script>
<meta charset="utf-8">

  <title>I love the air</title>

</head>

<body>
<p id="averages"> </p>
<div id="tempChart_container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>
<div id="humidityChart_container" style="min-width: 400px; height: 400px; margin: 0 auto"></div>

<script>

var tempChart = new Highcharts.stockChart({
	title: { text: 'Air Temp' },
	xAxis: {
		type: 'datetime',
		tickPixelInterval: 10
	},
	yAxis: {
		title: { text: 'temp (c)' },
		tickInterval: 5,
	},
        tooltip: {
            valueSuffix: '°C'
        },
	rangeSelector: {
		enabled: true,
		allButtonsEnabled: true
        },
	chart: {
		type: 'spline',
		zoomType: "x",
		renderTo: 'tempChart_container',
		events: {
		}
	},
});

var humidityChart = new Highcharts.stockChart({
	title: { text: 'Air Humidity' },
	xAxis: {
		type: 'datetime',
		tickPixelInterval: 10
	},
	yAxis: {
		title: { text: 'Humidity (%)' },
		tickInterval: 10,
	},
        tooltip: {
            valueSuffix: '%'
        },
	rangeSelector: {
		enabled: true,
		allButtonsEnabled: true
        },
	chart: {
		type: 'spline',
		zoomType: "x",
		renderTo: 'humidityChart_container',
		events: {
		}
	}
});

var charts = [tempChart, humidityChart];
</script>
<script>
socket.on('chartInit', function (sample) { // initalize with historical data
	tempChart.addSeries({data:(sample.data.map(function(value,index) { return  [value[0], value[1]]})), name:sample.name, id:sample.name});
	humidityChart.addSeries({data:(sample.data.map(function(value,index) { return  [value[0], value[2]]})), name:sample.name, id:sample.name});
});
socket.on('chartUpdate', function (sample){
	tempChart.get(sample.name).addPoint([sample.data[0][0], sample.data[0][1]]);
	humidityChart.get(sample.name).addPoint([sample.data[0][0], sample.data[0][2]]);
});
socket.on("averagesInit", function (sample){
<!-- TODO put week and day averages in addition to alltime -->
	document.getElementById("averages").innerHTML = `<b>Average Temperature:</b>${sample.data[0]}°C <b>Average Humidity:</b>${sample.data[1]}% <b>Average Pressure:</b> ${sample.data[2]}hPa`
});
</script>
</script>
</body>
</html>
</body>
</html>
</script>
<p> made by me (Elam) </p>
</body>
</html>
